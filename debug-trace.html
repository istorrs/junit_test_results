<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Debug Trace - Navigation Test</title>
        <style>
            body {
                font-family: monospace;
                padding: 20px;
                background: #1e1e1e;
                color: #d4d4d4;
            }
            .log {
                background: #252526;
                border: 1px solid #3e3e42;
                border-radius: 4px;
                padding: 10px;
                margin: 10px 0;
                max-height: 400px;
                overflow-y: auto;
            }
            .log-entry {
                padding: 5px;
                border-bottom: 1px solid #3e3e42;
            }
            .error {
                color: #f48771;
            }
            .warn {
                color: #dcdcaa;
            }
            .info {
                color: #4ec9b0;
            }
            button {
                background: #0e639c;
                color: white;
                border: none;
                padding: 10px 20px;
                margin: 5px;
                border-radius: 4px;
                cursor: pointer;
                font-family: monospace;
            }
            button:hover {
                background: #1177bb;
            }
            .test-section {
                margin: 20px 0;
                padding: 15px;
                background: #252526;
                border-radius: 4px;
            }
        </style>
    </head>
    <body>
        <h1>üîç Navigation Debug Trace</h1>

        <div class="test-section">
            <h2>Test Navigation Links</h2>
            <p>Click these buttons and watch the console logs below:</p>

            <button onclick="testHistoryNavigation()">Test View History Navigation</button>
            <button onclick="testFlakyPage()">Test Flaky Tests Page</button>
            <button onclick="testDirectURL()">Test Direct test-case-history.html</button>
            <button onclick="clearLogs()">Clear Logs</button>
        </div>

        <div class="test-section">
            <h2>URL Information</h2>
            <div id="url-info"></div>
        </div>

        <div class="test-section">
            <h2>Console Logs</h2>
            <div id="log-container" class="log"></div>
        </div>

        <div class="test-section">
            <h2>Network Requests</h2>
            <div id="network-container" class="log"></div>
        </div>

        <script>
            const logContainer = document.getElementById('log-container');
            const networkContainer = document.getElementById('network-container');
            const urlInfo = document.getElementById('url-info');

            // Display current URL info
            function updateURLInfo() {
                urlInfo.innerHTML = `
                <div class="log-entry info">Current URL: ${window.location.href}</div>
                <div class="log-entry info">Protocol: ${window.location.protocol}</div>
                <div class="log-entry info">Hostname: ${window.location.hostname}</div>
                <div class="log-entry info">Port: ${window.location.port}</div>
                <div class="log-entry info">Pathname: ${window.location.pathname}</div>
            `;
            }
            updateURLInfo();

            // Intercept console methods
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;

            function addLog(message, type = 'info') {
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.textContent = `[${new Date().toISOString()}] ${message}`;
                logContainer.appendChild(entry);
                logContainer.scrollTop = logContainer.scrollHeight;
            }

            console.log = function (...args) {
                originalLog.apply(console, args);
                addLog(args.join(' '), 'info');
            };

            console.error = function (...args) {
                originalError.apply(console, args);
                addLog('ERROR: ' + args.join(' '), 'error');
            };

            console.warn = function (...args) {
                originalWarn.apply(console, args);
                addLog('WARN: ' + args.join(' '), 'warn');
            };

            // Intercept fetch requests
            const originalFetch = window.fetch;
            window.fetch = function (...args) {
                const url = args[0];
                addNetworkLog(`FETCH: ${url}`);
                return originalFetch
                    .apply(this, args)
                    .then(response => {
                        addNetworkLog(`FETCH RESPONSE: ${url} - Status: ${response.status}`);
                        return response;
                    })
                    .catch(error => {
                        addNetworkLog(`FETCH ERROR: ${url} - ${error.message}`, 'error');
                        throw error;
                    });
            };

            function addNetworkLog(message, type = 'info') {
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.textContent = `[${new Date().toISOString()}] ${message}`;
                networkContainer.appendChild(entry);
                networkContainer.scrollTop = networkContainer.scrollHeight;
            }

            // Track navigation
            window.addEventListener('beforeunload', function (e) {
                console.log('Page is about to unload');
            });

            // Detect if we're being redirected
            let navigationStartTime = Date.now();
            window.addEventListener('load', function () {
                console.log('Page loaded in ' + (Date.now() - navigationStartTime) + 'ms');
            });

            // Test functions
            function testHistoryNavigation() {
                console.log('=== Testing View History Navigation ===');
                const testName = 'testExample';
                const testClass = 'com.example.TestClass';
                const params = new URLSearchParams({
                    name: testName,
                    classname: testClass
                });
                const targetUrl = `test-case-history.html?${params.toString()}`;
                console.log('Navigating to: ' + targetUrl);
                console.log('Full URL will be: ' + new URL(targetUrl, window.location.href).href);

                // Simulate what the button does
                setTimeout(() => {
                    window.location.href = targetUrl;
                }, 100);
            }

            function testFlakyPage() {
                console.log('=== Testing Flaky Tests Page ===');
                const targetUrl = 'flaky-tests.html';
                console.log('Navigating to: ' + targetUrl);
                setTimeout(() => {
                    window.location.href = targetUrl;
                }, 100);
            }

            function testDirectURL() {
                console.log('=== Testing Direct URL Access ===');
                const targetUrl = 'test-case-history.html?name=test&classname=com.example.Test';
                console.log('Navigating to: ' + targetUrl);
                setTimeout(() => {
                    window.location.href = targetUrl;
                }, 100);
            }

            function clearLogs() {
                logContainer.innerHTML = '';
                networkContainer.innerHTML = '';
                console.log('Logs cleared');
            }

            // Check if files exist
            console.log('=== Checking if pages exist ===');
            fetch('test-case-history.html', { method: 'HEAD' })
                .then(r =>
                    console.log(
                        'test-case-history.html exists: ' + r.ok + ' (status: ' + r.status + ')'
                    )
                )
                .catch(e => console.error('Error checking test-case-history.html: ' + e.message));

            fetch('flaky-tests.html', { method: 'HEAD' })
                .then(r =>
                    console.log('flaky-tests.html exists: ' + r.ok + ' (status: ' + r.status + ')')
                )
                .catch(e => console.error('Error checking flaky-tests.html: ' + e.message));

            console.log('Debug trace page loaded and ready');
        </script>
    </body>
</html>
