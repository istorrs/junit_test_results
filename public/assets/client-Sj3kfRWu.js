class i{baseUrl="/api/v1";async request(e,t){const r=`${this.baseUrl}${e}`,n=await fetch(r,t);if(!n.ok)throw new Error(`Failed to ${t?.method||"GET"} ${e}: ${n.status}`);return(await n.json()).data}buildQueryString(e){const t=Object.fromEntries(Object.entries(e).filter(([,n])=>n!=null));return Object.keys(t).length===0?"":`?${new URLSearchParams(t).toString()}`}async getRuns(e={}){const t={page:e.page||1,limit:e.limit||50,...e},r=this.buildQueryString(t),n=await this.request(`/runs${r}`);return{runs:n.runs.map(s=>({...s,id:s._id||s.id,summary:{total:s.total_tests||0,passed:(s.total_tests||0)-(s.total_failures||0)-(s.total_errors||0)-(s.total_skipped||0),failed:s.total_failures||0,errors:s.total_errors||0,skipped:s.total_skipped||0}})),pagination:n.pagination}}async getProjects(){return(await this.request("/runs/projects")).projects}async getStats(e={}){const t=this.buildQueryString(e);return this.request(`/stats/overview${t}`)}async getTestCases(e={}){const t={page:e.page||1,limit:e.limit||50,...e},r=this.buildQueryString(t),n=await this.request(`/cases${r}`);return{cases:n.cases.map(s=>({...s,id:s._id||s.id,suite_name:s.classname||s.suite_name,error_message:s.result?.error_message||s.result?.failure_message||s.error_message,error_type:s.result?.error_type||s.result?.failure_type||s.error_type})),pagination:n.pagination}}async uploadTestResults(e){const t=new FormData;t.append("file",e);const r=await fetch(`${this.baseUrl}/upload`,{method:"POST",body:t});if(!r.ok)throw new Error(`Failed to upload test results: ${r.status}`);return(await r.json()).data}async getTestHistory(e){return this.request(`/cases/${e}/history`)}async getTestFlakiness(e){return this.request(`/cases/${e}/flakiness`)}async getFailurePatterns(e){const t=this.buildQueryString(e||{});return this.request(`/analytics/failure-patterns${t}`)}async getFlakyTests(e=10){return this.request(`/analytics/flaky-tests?limit=${e}`)}async getReleases(e){const t=this.buildQueryString(e||{});return this.request(`/releases${t}`)}async compareReleases(e,t){return this.request(`/releases/compare?release1=${e}&release2=${t}`)}async getReleaseRuns(e,t){const r=this.buildQueryString(t||{});return this.request(`/releases/${e}/runs${r}`)}async compareRuns(e,t){return this.request(`/comparison/runs?run1=${e}&run2=${t}`)}async getTestComparisonHistory(e,t){const r=this.buildQueryString(t||{});return this.request(`/comparison/test/${e}${r}`)}async getPerformanceTrends(e){const t=this.buildQueryString(e||{});return this.request(`/performance/trends${t}`)}async getSlowestTests(e){const t=this.buildQueryString(e||{});return this.request(`/performance/slowest${t}`)}async getPerformanceRegressions(e){const t=this.buildQueryString(e||{});return this.request(`/performance/regressions${t}`)}async getTestPerformanceHistory(e,t){const r=this.buildQueryString(t||{});return this.request(`/performance/test/${e}${r}`)}}const u=new i;export{u as a};
