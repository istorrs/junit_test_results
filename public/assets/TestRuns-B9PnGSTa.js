import{d as U,r as f,e as g,o as M,c as o,f as a,g as _,h as n,u as k,l as P,b as l,i as R,t as r,m as A,k as i,p as y,v as D,F as $,q,s as S,j as z,_ as E}from"./index-DoDLnzXg.js";import{u as I,B as h,b as H}from"./Button-GtyLz5Q5.js";import{D as J,S as Q}from"./SearchInput-MwdGTprE.js";const w={class:"test-runs"},G={class:"page-header"},K={class:"header-actions"},O={class:"filters-grid"},W={class:"filter-group"},X={class:"filter-group"},Y=["value"],Z={class:"filter-group"},ee={class:"filter-group"},te={class:"filter-group"},ae={class:"filter-group align-end"},se={class:"run-name"},le={key:0,class:"run-meta"},oe={key:0,class:"meta-tag"},re={key:1,class:"meta-tag branch"},ne={key:2,class:"meta-tag build"},ue={class:"timestamp"},ie={key:0,class:"summary-badges"},de={class:"badge passed"},me={class:"badge failed"},ce={key:0,class:"badge error"},pe={key:1,class:"badge skipped"},ve={key:1,class:"no-data"},fe={key:0,class:"success-rate"},_e={key:1,class:"no-data"},ye=U({__name:"TestRuns",setup(be){const T=P(),d=I(),m=f(""),c=f(""),u=f(""),p=f(""),v=f(""),j=[{key:"name",label:"Run Name",sortable:!0},{key:"timestamp",label:"Date",sortable:!0},{key:"total",label:"Total Tests",sortable:!0},{key:"summary",label:"Results",sortable:!1},{key:"rate",label:"Success Rate",sortable:!0}],V=g(()=>{const s=new Set;return d.runs.forEach(t=>{t.ci_metadata?.job_name&&s.add(t.ci_metadata.job_name)}),Array.from(s).sort()}),F=g(()=>{let s=[...d.runs];if(m.value){const t=m.value.toLowerCase();s=s.filter(e=>e.name?.toLowerCase().includes(t)||e.ci_metadata?.job_name?.toLowerCase().includes(t)||e.ci_metadata?.branch?.toLowerCase().includes(t)||e.id?.toLowerCase().includes(t))}if(c.value&&(s=s.filter(t=>t.ci_metadata?.job_name===c.value)),u.value&&(s=s.filter(t=>{if(!t.summary)return!1;const e=b(t);return u.value==="passed"?e===100:u.value==="failed"?e===0:u.value==="mixed"?e>0&&e<100:!0})),p.value){const t=new Date(p.value);s=s.filter(e=>new Date(e.timestamp)>=t)}if(v.value){const t=new Date(v.value);t.setHours(23,59,59,999),s=s.filter(e=>new Date(e.timestamp)<=t)}return s}),x=g(()=>!!(m.value||c.value||u.value||p.value||v.value)),b=s=>!s.summary||s.summary.total===0?0:Math.round(s.summary.passed/s.summary.total*100),N=s=>s===100?"rate-perfect":s>=80?"rate-good":s>=50?"rate-medium":"rate-poor",B=()=>{m.value="",c.value="",u.value="",p.value="",v.value=""},L=s=>{d.setCurrentRun(s),T.push(`/cases?run_id=${s.id}`)},C=async()=>{try{await d.fetchRuns({limit:100})}catch(s){console.error("Failed to load test runs:",s)}};return M(()=>{C()}),(s,t)=>(l(),o("div",w,[a("div",G,[t[9]||(t[9]=a("h1",null,"Test Runs",-1)),a("div",K,[_(h,{onClick:C,loading:k(d).loading,variant:"secondary"},{default:n(()=>[...t[7]||(t[7]=[R(" Refresh ",-1)])]),_:1},8,["loading"]),_(h,{onClick:t[0]||(t[0]=e=>s.$router.push("/upload"))},{default:n(()=>[...t[8]||(t[8]=[R(" Upload New Results ",-1)])]),_:1})])]),_(J,{columns:j,data:F.value,loading:k(d).loading,"row-clickable":!0,onRowClick:t[6]||(t[6]=e=>L(e))},{filters:n(()=>[a("div",O,[a("div",W,[t[10]||(t[10]=a("label",null,"Search",-1)),_(Q,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),placeholder:"Search by name, job, branch..."},null,8,["modelValue"])]),a("div",X,[t[12]||(t[12]=a("label",null,"Project/Job",-1)),y(a("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>c.value=e),class:"filter-select"},[t[11]||(t[11]=a("option",{value:""},"All Projects",-1)),(l(!0),o($,null,q(V.value,e=>(l(),o("option",{key:e,value:e},r(e),9,Y))),128))],512),[[D,c.value]])]),a("div",Z,[t[14]||(t[14]=a("label",null,"Status",-1)),y(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>u.value=e),class:"filter-select"},[...t[13]||(t[13]=[a("option",{value:""},"All",-1),a("option",{value:"passed"},"Passed",-1),a("option",{value:"failed"},"Failed",-1),a("option",{value:"mixed"},"Mixed",-1)])],512),[[D,u.value]])]),a("div",ee,[t[15]||(t[15]=a("label",null,"Date Range",-1)),y(a("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>p.value=e),type:"date",class:"filter-input",placeholder:"From"},null,512),[[S,p.value]])]),a("div",te,[t[16]||(t[16]=a("label",null,"To",-1)),y(a("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>v.value=e),type:"date",class:"filter-input",placeholder:"To"},null,512),[[S,v.value]])]),a("div",ae,[x.value?(l(),z(h,{key:0,onClick:B,variant:"secondary",size:"sm"},{default:n(()=>[...t[17]||(t[17]=[R(" Clear Filters ",-1)])]),_:1})):i("",!0)])])]),"cell-name":n(({row:e})=>[a("div",se,[a("strong",null,r(e.name||`Run ${e.id?.slice(0,8)}`),1),e.ci_metadata?(l(),o("div",le,[e.ci_metadata.job_name?(l(),o("span",oe,r(e.ci_metadata.job_name),1)):i("",!0),e.ci_metadata.branch?(l(),o("span",re," ðŸŒ¿ "+r(e.ci_metadata.branch),1)):i("",!0),e.ci_metadata.build_number?(l(),o("span",ne," #"+r(e.ci_metadata.build_number),1)):i("",!0)])):i("",!0)])]),"cell-timestamp":n(({value:e})=>[a("span",ue,r(k(H)(e)),1)]),"cell-summary":n(({row:e})=>[e.summary?(l(),o("div",ie,[a("span",de,"âœ“ "+r(e.summary.passed),1),a("span",me,"âœ— "+r(e.summary.failed),1),e.summary.errors?(l(),o("span",ce,"âš  "+r(e.summary.errors),1)):i("",!0),e.summary.skipped?(l(),o("span",pe,"âŠ˜ "+r(e.summary.skipped),1)):i("",!0)])):(l(),o("span",ve,"No data"))]),"cell-total":n(({row:e})=>[a("strong",null,r(e.summary?.total||0),1)]),"cell-rate":n(({row:e})=>[e.summary&&e.summary.total>0?(l(),o("div",fe,[a("span",{class:A(N(b(e)))},r(b(e))+"% ",3)])):(l(),o("span",_e,"-"))]),_:1},8,["data","loading"])]))}}),he=E(ye,[["__scopeId","data-v-5d8f1881"]]);export{he as default};
