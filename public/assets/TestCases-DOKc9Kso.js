import{d as E,c as x,b as n,i as k,e as a,h as e,t as o,k as D,_ as A,r as C,F as V,j as z,w as H,o as O,a as U,f as I,g as T,q as M,x as F,m as w,l as L,p as R,y as G,v as P}from"./index-DHPa7hmi.js";import{a as B,b as j,B as N,u as Q,t as J,g as K}from"./Button-DFMCrOql.js";import{D as X,S as Y}from"./SearchInput-Cw5jwD_Q.js";import{M as Z}from"./Modal-Dagv4eVA.js";import{i as ee,L as W}from"./index-B-ioSKa-.js";import{a as q}from"./client-Sj3kfRWu.js";const te=["title"],se={class:"label"},ae=E({__name:"FlakinessIndicator",props:{passRate:{},recentRuns:{},failureCount:{},size:{default:"md"},showLabel:{type:Boolean,default:!0}},setup(l){const u=l,d=x(()=>u.passRate<100&&u.passRate>0),p=x(()=>100-u.passRate),f=x(()=>p.value<10?"severity-low":p.value<30?"severity-medium":"severity-high"),h=x(()=>`size-${u.size}`),S=x(()=>u.showLabel?`${Math.round(u.passRate)}%`:""),v=x(()=>`Flaky: ${u.failureCount}/${u.recentRuns} recent runs failed (${Math.round(u.passRate)}% pass rate)`);return(_,y)=>d.value?(a(),n("div",{key:0,class:D(["flakiness-indicator",h.value,f.value]),title:v.value},[y[0]||(y[0]=e("span",{class:"icon"},"‚ö†Ô∏è",-1)),e("span",se,o(S.value),1)],10,te)):k("",!0)}}),le=A(ae,[["__scopeId","data-v-3adf74bd"]]),oe={class:"stack-trace-container"},re={key:0,class:"stack-trace-header"},ne={class:"icon"},ie={key:1,class:"stack-trace"},ue=E({__name:"ErrorStackTrace",props:{stackTrace:{},language:{default:"java"},collapsible:{type:Boolean,default:!1},initialLines:{default:10}},setup(l){const u=l,d=C(!u.collapsible),p=C(!1),f=x(()=>u.stackTrace.split(`
`).filter(m=>m.trim())),h=x(()=>!u.collapsible||p.value?f.value:f.value.slice(0,u.initialLines)),S=x(()=>f.value.length>u.initialLines),v=x(()=>f.value.length-u.initialLines),_=m=>{const b=m.trim();if(u.language==="java"){if(b.startsWith("at "))return!b.includes("org.junit")&&!b.includes("org.testng")&&!b.includes("java.lang")&&!b.includes("sun.reflect")&&!b.includes("org.springframework")?"frame user-code":"frame framework-code";if(b.startsWith("Caused by:"))return"caused-by";if(b.startsWith("..."))return"ellipsis"}if(u.language==="python"){if(b.startsWith('File "'))return"frame user-code";if(b.includes("Traceback"))return"traceback-header"}return u.language==="javascript"&&b.startsWith("at ")?b.includes("node_modules")?"frame framework-code":"frame user-code":"frame"},y=()=>{navigator.clipboard.writeText(u.stackTrace)};return(m,b)=>(a(),n("div",oe,[l.collapsible?(a(),n("div",re,[e("button",{onClick:b[0]||(b[0]=$=>d.value=!d.value),class:"expand-button"},[e("span",ne,o(d.value?"‚ñº":"‚ñ∂"),1),e("span",null,o(d.value?"Collapse":"Expand")+" Stack Trace",1)]),e("button",{onClick:y,class:"copy-button",title:"Copy to clipboard"}," üìã Copy ")])):k("",!0),!l.collapsible||d.value?(a(),n("div",ie,[(a(!0),n(V,null,z(h.value,($,i)=>(a(),n("pre",{key:i,class:D(_($))},o($),3))),128)),l.collapsible&&S.value?(a(),n("button",{key:0,onClick:b[1]||(b[1]=$=>p.value=!p.value),class:"show-more-button"},o(p.value?"Show Less":`Show ${v.value} More Lines`),1)):k("",!0)])):k("",!0)]))}}),de=A(ue,[["__scopeId","data-v-ec9f3ba8"]]),ce={class:"history-chart-container"},ve={key:0,class:"empty-state"},me=E({__name:"HistoryChart",props:{data:{}},setup(l){const u=l,d=C();let p=null;const f=x(()=>u.data&&u.data.length>0),h=x(()=>{if(!u.data)return{dates:[],statuses:[],durations:[]};const _=[...u.data].sort((y,m)=>new Date(y.timestamp).getTime()-new Date(m.timestamp).getTime());return{dates:_.map(y=>new Date(y.timestamp).toLocaleDateString()),statuses:_.map(y=>y.status==="passed"?1:y.status==="failed"?-1:y.status==="error"?-2:0),durations:_.map(y=>y.duration),runs:_}}),S=()=>{if(!d.value||!f.value)return;const _=document.documentElement.getAttribute("data-theme")==="dark";p=ee(d.value);const y=()=>{const i=getComputedStyle(document.documentElement);return{success:i.getPropertyValue("--success-color").trim()||"#10b981",error:i.getPropertyValue("--error-color").trim()||"#ef4444",warning:i.getPropertyValue("--warning-color").trim()||"#f59e0b",text:i.getPropertyValue("--text-primary").trim()||"#111827",textSecondary:i.getPropertyValue("--text-secondary").trim()||"#6b7280",border:i.getPropertyValue("--border-color").trim()||"#e5e7eb"}},m=y(),b={backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:_?"#1f2937":"#ffffff",borderColor:m.border,textStyle:{color:m.text},formatter:i=>{const g=i[0].dataIndex,t=h.value.runs?.[g];if(!t)return"";const r=t.status,s=(t.duration*1e3).toFixed(0)+"ms";return`<div style="padding: 0.5rem;">
          <div style="font-weight: 600; margin-bottom: 0.5rem;">${i[0].name}</div>
          <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
            <span style="color: ${r==="passed"?m.success:m.error};">‚óè</span>
            <span>Status: ${r}</span>
          </div>
          <div>Duration: ${s}</div>
        </div>`}},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",data:h.value.dates,axisLine:{lineStyle:{color:m.border}},axisLabel:{color:m.textSecondary,fontSize:11,rotate:45}},yAxis:[{type:"value",name:"Status",position:"left",min:-2.5,max:1.5,interval:1,axisLine:{lineStyle:{color:m.border}},axisLabel:{color:m.textSecondary,fontSize:11,formatter:i=>i===1?"Pass":i===0?"Skip":i===-1?"Fail":i===-2?"Error":""},splitLine:{lineStyle:{color:m.border,opacity:.3}}},{type:"value",name:"Duration (s)",position:"right",axisLine:{lineStyle:{color:m.border}},axisLabel:{color:m.textSecondary,fontSize:11,formatter:"{value}s"},splitLine:{show:!1}}],series:[{name:"Status",type:"line",yAxisIndex:0,data:h.value.statuses,symbol:"circle",symbolSize:8,itemStyle:{color:i=>{const g=i.value;return g===1?m.success:g===-1?m.error:g===-2?m.warning:m.textSecondary}},lineStyle:{width:2,color:m.text,opacity:.3},areaStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(16, 185, 129, 0.2)"},{offset:.5,color:"rgba(156, 163, 175, 0.1)"},{offset:1,color:"rgba(239, 68, 68, 0.2)"}])}},{name:"Duration",type:"bar",yAxisIndex:1,data:h.value.durations,itemStyle:{color:new W(0,0,0,1,[{offset:0,color:"rgba(59, 130, 246, 0.8)"},{offset:1,color:"rgba(59, 130, 246, 0.3)"}]),borderRadius:[4,4,0,0]},barMaxWidth:20}]};p.setOption(b),new MutationObserver(()=>{if(p){const i=y();p.setOption({tooltip:{backgroundColor:document.documentElement.getAttribute("data-theme")==="dark"?"#1f2937":"#ffffff",textStyle:{color:i.text}},xAxis:{axisLine:{lineStyle:{color:i.border}},axisLabel:{color:i.textSecondary}},yAxis:[{axisLine:{lineStyle:{color:i.border}},axisLabel:{color:i.textSecondary},splitLine:{lineStyle:{color:i.border}}},{axisLine:{lineStyle:{color:i.border}},axisLabel:{color:i.textSecondary}}]})}}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]})},v=()=>{p?.resize()};return H(()=>u.data,()=>{p&&f.value&&(p.dispose(),S())},{deep:!0}),O(()=>{f.value&&(S(),window.addEventListener("resize",v))}),U(()=>{p?.dispose(),window.removeEventListener("resize",v)}),(_,y)=>(a(),n("div",ce,[f.value?(a(),n("div",{key:1,ref_key:"chartRef",ref:d,class:"chart"},null,512)):(a(),n("div",ve,[...y[0]||(y[0]=[e("p",null,"No history data available",-1)])]))]))}}),fe=A(me,[["__scopeId","data-v-3b44f83f"]]),pe={class:"flex items-center justify-between w-full"},ye={class:"flex-1 min-w-0"},be={class:"text-xl font-semibold truncate"},ge={class:"text-sm text-secondary mt-1"},he={class:"flex items-center gap-2 ml-4"},_e={class:"tabs-container"},ke={class:"tabs-nav"},xe=["onClick"],Se={class:"tab-content"},Ce={key:0,class:"loading-state"},Te={key:1,class:"error-state"},$e={class:"error-message"},we={key:2},Le={class:"tab-panel"},De={class:"info-grid"},Me={class:"info-item"},Re={class:"info-item"},Ne={class:"value"},Ee={class:"info-item"},Ae={class:"value"},Fe={class:"info-item"},Ie={class:"value"},Ve={key:0,class:"flakiness-summary"},ze={class:"stability-stats"},Be={class:"stat"},Pe={class:"stat-value"},je={class:"stat"},We={class:"stat-value"},qe={class:"stat"},He={class:"stat-value"},Oe={class:"tab-panel"},Ue={key:0,class:"failure-details"},Ge={class:"error-header"},Qe={key:0,class:"error-type-badge"},Je={key:0,class:"error-message-box"},Ke={key:1,class:"stack-trace-section"},Xe={key:1,class:"empty-state"},Ye={class:"tab-panel"},Ze={key:0,class:"history-section"},et={class:"history-chart"},tt={class:"history-table"},st={class:"run-id"},at={key:1,class:"empty-state"},lt={class:"tab-panel"},ot={class:"metadata-section"},rt={class:"metadata-grid"},nt={class:"metadata-item"},it={class:"code-value"},ut={class:"metadata-item"},dt={class:"code-value"},ct={key:0,class:"metadata-item"},vt={class:"code-value"},mt={key:1,class:"metadata-item"},ft={class:"code-value"},pt={class:"modal-footer"},yt=E({__name:"TestDetailsModal",props:{open:{type:Boolean},testId:{},testName:{},status:{},duration:{},errorMessage:{},errorType:{},stackTrace:{},className:{},lastRun:{},ciMetadata:{}},emits:["close"],setup(l,{emit:u}){const d=l,p=u,f=C("overview"),h=C(!1),S=C(null),v=C(null),_=C([]),y=[{id:"overview",label:"Overview"},{id:"failure",label:"Failure Details"},{id:"history",label:"History"},{id:"metadata",label:"Metadata"}],m=x(()=>{const g=d.status?.toLowerCase();return g==="passed"?"status-passed":g==="failed"?"status-failed":g==="error"?"status-error":"status-skipped"});H(()=>d.open,async g=>{g&&d.testId&&await b()});const b=async()=>{h.value=!0,S.value=null;try{const[g,t]=await Promise.all([q.getTestFlakiness(d.testId).catch(()=>null),q.getTestHistory(d.testId).catch(()=>({runs:[]}))]);v.value=g,_.value=t.runs||[]}catch(g){S.value="Failed to load test details",console.error("Error loading test details:",g)}finally{h.value=!1}},$=()=>{p("close"),f.value="overview"},i=()=>{const g=[`Test: ${d.testName}`,`Status: ${d.status}`,d.errorType&&`Error Type: ${d.errorType}`,d.errorMessage&&`
Error Message:
${d.errorMessage}`,d.stackTrace&&`
Stack Trace:
${d.stackTrace}`].filter(Boolean).join(`
`);navigator.clipboard.writeText(g)};return(g,t)=>(a(),I(Z,{open:l.open,onClose:$,size:"xl"},{header:T(()=>[e("div",pe,[e("div",ye,[e("h2",be,o(l.testName),1),e("p",ge,o(l.className||"Unknown suite"),1)]),e("div",he,[e("span",{class:D(["badge",m.value])},o(l.status),3),v.value?(a(),I(le,{key:0,"pass-rate":v.value.pass_rate,"recent-runs":v.value.total_runs,"failure-count":v.value.recent_failures},null,8,["pass-rate","recent-runs","failure-count"])):k("",!0)])])]),footer:T(()=>[e("div",pt,[L(N,{variant:"secondary",onClick:$},{default:T(()=>[...t[20]||(t[20]=[R("Close",-1)])]),_:1}),l.errorMessage?(a(),I(N,{key:0,onClick:i},{default:T(()=>[...t[21]||(t[21]=[R(" Copy Error ",-1)])]),_:1})):k("",!0)])]),default:T(()=>[e("div",_e,[e("div",ke,[(a(),n(V,null,z(y,r=>e("button",{key:r.id,class:D(["tab-button",{active:f.value===r.id}]),onClick:s=>f.value=r.id},o(r.label),11,xe)),64))]),e("div",Se,[h.value?(a(),n("div",Ce,[...t[0]||(t[0]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading test details...",-1)])])):S.value?(a(),n("div",Te,[e("p",$e,o(S.value),1)])):(a(),n("div",we,[M(e("div",Le,[e("div",De,[e("div",Me,[t[1]||(t[1]=e("label",null,"Status",-1)),e("span",{class:D(["value",m.value])},o(l.status),3)]),e("div",Re,[t[2]||(t[2]=e("label",null,"Duration",-1)),e("span",Ne,o(l.duration?w(B)(l.duration*1e3):"N/A"),1)]),e("div",Ee,[t[3]||(t[3]=e("label",null,"Last Run",-1)),e("span",Ae,o(l.lastRun?w(j)(l.lastRun):"N/A"),1)]),e("div",Fe,[t[4]||(t[4]=e("label",null,"Test Suite",-1)),e("span",Ie,o(l.className||"N/A"),1)])]),v.value?(a(),n("div",Ve,[t[8]||(t[8]=e("h3",null,"Stability",-1)),e("div",ze,[e("div",Be,[e("span",Pe,o(v.value.pass_rate)+"%",1),t[5]||(t[5]=e("span",{class:"stat-label"},"Pass Rate",-1))]),e("div",je,[e("span",We,o(v.value.total_runs),1),t[6]||(t[6]=e("span",{class:"stat-label"},"Total Runs",-1))]),e("div",qe,[e("span",He,o(v.value.recent_failures),1),t[7]||(t[7]=e("span",{class:"stat-label"},"Recent Failures",-1))])])])):k("",!0)],512),[[F,f.value==="overview"]]),M(e("div",Oe,[l.errorMessage||l.errorType?(a(),n("div",Ue,[e("div",Ge,[t[9]||(t[9]=e("h3",null,"Error Information",-1)),l.errorType?(a(),n("span",Qe,o(l.errorType),1)):k("",!0)]),l.errorMessage?(a(),n("div",Je,[t[10]||(t[10]=e("h4",null,"Error Message",-1)),e("pre",null,o(l.errorMessage),1)])):k("",!0),l.stackTrace?(a(),n("div",Ke,[t[11]||(t[11]=e("h4",null,"Stack Trace",-1)),L(de,{"stack-trace":l.stackTrace,collapsible:!0},null,8,["stack-trace"])])):k("",!0)])):(a(),n("div",Xe,[...t[12]||(t[12]=[e("p",null,"No failure details available - test passed or no error data recorded",-1)])]))],512),[[F,f.value==="failure"]]),M(e("div",Ye,[_.value&&_.value.length>0?(a(),n("div",Ze,[e("h3",null,"Test Execution History (Last "+o(_.value.length)+" Runs)",1),e("div",et,[L(fe,{data:_.value},null,8,["data"])]),e("div",tt,[e("table",null,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"Date"),e("th",null,"Status"),e("th",null,"Duration"),e("th",null,"Run ID")])],-1)),e("tbody",null,[(a(!0),n(V,null,z(_.value.slice(0,10),r=>(a(),n("tr",{key:r.run_id},[e("td",null,o(w(j)(r.timestamp)),1),e("td",null,[e("span",{class:D(["status-badge",r.status])},o(r.status),3)]),e("td",null,o(w(B)(r.duration*1e3)),1),e("td",st,o(r.run_id.slice(0,8)),1)]))),128))])])])])):(a(),n("div",at,[...t[14]||(t[14]=[e("p",null,"No historical data available",-1)])]))],512),[[F,f.value==="history"]]),M(e("div",lt,[e("div",ot,[t[19]||(t[19]=e("h3",null,"Test Metadata",-1)),e("div",rt,[e("div",nt,[t[15]||(t[15]=e("label",null,"Test Name",-1)),e("span",it,o(l.testName),1)]),e("div",ut,[t[16]||(t[16]=e("label",null,"Class/Suite",-1)),e("span",dt,o(l.className||"N/A"),1)]),l.ciMetadata?(a(),n("div",ct,[t[17]||(t[17]=e("label",null,"Build Number",-1)),e("span",vt,o(l.ciMetadata.build_number||"N/A"),1)])):k("",!0),l.ciMetadata?(a(),n("div",mt,[t[18]||(t[18]=e("label",null,"Branch",-1)),e("span",ft,o(l.ciMetadata.branch||"N/A"),1)])):k("",!0)])])],512),[[F,f.value==="metadata"]])]))])])]),_:1},8,["open"]))}}),bt=A(yt,[["__scopeId","data-v-bd7d84a7"]]),gt={class:"test-cases"},ht={class:"page-header"},_t={class:"header-actions"},kt={class:"filters-grid"},xt={class:"filter-group"},St={class:"filter-group"},Ct={class:"filter-group"},Tt=["value"],$t={class:"filter-group align-end"},wt={class:"test-name"},Lt={key:0,class:"test-meta"},Dt={key:0,class:"meta-info"},Mt={key:1,class:"meta-info suite"},Rt={key:1,class:"error-preview"},Nt={class:"duration"},Et=E({__name:"TestCases",setup(l){const u=G(),d=Q(),p=C(""),f=C(""),h=C(""),S=C(!1),v=C(null),_=[{key:"status",label:"Status",sortable:!0},{key:"name",label:"Test Name",sortable:!0},{key:"time",label:"Duration",sortable:!0}],y=x(()=>{const r=new Set;return d.cases.forEach(s=>{s.suite_name&&r.add(s.suite_name)}),Array.from(r).sort()}),m=x(()=>{let r=[...d.cases];if(p.value){const s=p.value.toLowerCase();r=r.filter(c=>c.name?.toLowerCase().includes(s)||c.classname?.toLowerCase().includes(s))}return f.value&&(r=r.filter(s=>s.status===f.value)),h.value&&(r=r.filter(s=>s.suite_name===h.value)),r}),b=x(()=>!!(p.value||f.value||h.value)),$=()=>{p.value="",f.value="",h.value=""},i=async()=>{try{const r=u.query.run_id?{run_id:u.query.run_id}:{};await d.fetchCases(r)}catch(r){console.error("Failed to load test cases:",r)}},g=r=>{v.value=r,S.value=!0},t=()=>{S.value=!1};return O(()=>{i()}),(r,s)=>(a(),n("div",gt,[e("div",ht,[s[6]||(s[6]=e("h1",null,"Test Cases",-1)),e("div",_t,[L(N,{onClick:i,loading:w(d).loading,variant:"secondary"},{default:T(()=>[...s[4]||(s[4]=[R(" Refresh ",-1)])]),_:1},8,["loading"]),L(N,{onClick:s[0]||(s[0]=c=>r.$router.push("/runs"))},{default:T(()=>[...s[5]||(s[5]=[R(" View Test Runs ",-1)])]),_:1})])]),L(X,{columns:_,data:m.value,loading:w(d).loading,"row-clickable":!0,onRowClick:g},{filters:T(()=>[e("div",kt,[e("div",xt,[s[7]||(s[7]=e("label",null,"Search",-1)),L(Y,{modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=c=>p.value=c),placeholder:"Search test names..."},null,8,["modelValue"])]),e("div",St,[s[9]||(s[9]=e("label",null,"Status",-1)),M(e("select",{"onUpdate:modelValue":s[2]||(s[2]=c=>f.value=c),class:"filter-select"},[...s[8]||(s[8]=[e("option",{value:""},"All Statuses",-1),e("option",{value:"passed"},"‚úì Passed",-1),e("option",{value:"failed"},"‚úó Failed",-1),e("option",{value:"error"},"‚ö† Error",-1),e("option",{value:"skipped"},"‚äò Skipped",-1)])],512),[[P,f.value]])]),e("div",Ct,[s[11]||(s[11]=e("label",null,"Suite",-1)),M(e("select",{"onUpdate:modelValue":s[3]||(s[3]=c=>h.value=c),class:"filter-select"},[s[10]||(s[10]=e("option",{value:""},"All Suites",-1)),(a(!0),n(V,null,z(y.value,c=>(a(),n("option",{key:c,value:c},o(c),9,Tt))),128))],512),[[P,h.value]])]),e("div",$t,[b.value?(a(),I(N,{key:0,onClick:$,variant:"secondary",size:"sm"},{default:T(()=>[...s[12]||(s[12]=[R(" Clear Filters ",-1)])]),_:1})):k("",!0)])])]),"cell-status":T(({row:c})=>[e("span",{class:D(["status-badge",c.status])},o(w(K)(c.status||""))+" "+o(c.status),3)]),"cell-name":T(({row:c})=>[e("div",wt,[e("strong",null,o(c.name),1),c.classname||c.suite_name?(a(),n("div",Lt,[c.classname?(a(),n("span",Dt,o(c.classname),1)):k("",!0),c.suite_name?(a(),n("span",Mt,o(c.suite_name),1)):k("",!0)])):k("",!0),c.error_message?(a(),n("div",Rt,o(w(J)(c.error_message||"",100)),1)):k("",!0)])]),"cell-time":T(({value:c})=>[e("span",Nt,o(w(B)((c||0)*1e3)),1)]),_:1},8,["data","loading"]),L(bt,{open:S.value,"test-id":v.value?.id||"","test-name":v.value?.name||"",status:v.value?.status||"passed",duration:v.value?.time,"error-message":v.value?.error_message,"error-type":v.value?.error_type,"stack-trace":v.value?.result?.stack_trace,"class-name":v.value?.classname||v.value?.suite_name,"last-run":v.value?.timestamp,"ci-metadata":v.value?.run_ci_metadata,onClose:t},null,8,["open","test-id","test-name","status","duration","error-message","error-type","stack-trace","class-name","last-run","ci-metadata"])]))}}),Pt=A(Et,[["__scopeId","data-v-6c951f95"]]);export{Pt as default};
