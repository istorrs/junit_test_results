import{C as k,r as u,c as f,d as q,b as g,k as F,i as B,z as j,e as m,_ as T}from"./index-DxqKypvE.js";class D{baseUrl="/api/v1";async request(t,s){const r=`${this.baseUrl}${t}`,n=await fetch(r,s);if(!n.ok)throw new Error(`Failed to ${s?.method||"GET"} ${t}: ${n.status}`);return(await n.json()).data}buildQueryString(t){const s=Object.fromEntries(Object.entries(t).filter(([,n])=>n!=null));return Object.keys(s).length===0?"":`?${new URLSearchParams(s).toString()}`}async getRuns(t={}){const s={page:t.page||1,limit:t.limit||50,...t},r=this.buildQueryString(s),n=await this.request(`/runs${r}`);return{runs:n.runs.map(e=>({...e,id:e._id||e.id,summary:{total:e.total_tests||0,passed:(e.total_tests||0)-(e.total_failures||0)-(e.total_errors||0)-(e.total_skipped||0),failed:e.total_failures||0,errors:e.total_errors||0,skipped:e.total_skipped||0}})),pagination:n.pagination}}async getProjects(){return(await this.request("/runs/projects")).projects}async getStats(t={}){const s=this.buildQueryString(t);return this.request(`/stats/overview${s}`)}async getTestCases(t={}){const s={page:t.page||1,limit:t.limit||50,...t},r=this.buildQueryString(s),n=await this.request(`/cases${r}`);return{cases:n.cases.map(e=>({...e,id:e._id||e.id,suite_name:e.classname||e.suite_name,error_message:e.result?.error_message||e.result?.failure_message||e.error_message,error_type:e.result?.error_type||e.result?.failure_type||e.error_type})),pagination:n.pagination}}async uploadTestResults(t){const s=new FormData;s.append("file",t);const r=await fetch(`${this.baseUrl}/upload`,{method:"POST",body:s});if(!r.ok)throw new Error(`Failed to upload test results: ${r.status}`);return(await r.json()).data}async getTestHistory(t){return this.request(`/cases/${t}/history`)}async getTestFlakiness(t){return this.request(`/cases/${t}/flakiness`)}async getFailurePatterns(t){const s=this.buildQueryString(t||{});return this.request(`/analytics/failure-patterns${s}`)}async getFlakyTests(t=10){return this.request(`/analytics/flaky-tests?limit=${t}`)}}const c=new D,C=k("testData",()=>{const a=u([]),t=u(null),s=u([]),r=u(null),n=u([]),l=u(!1),e=u(null),d=f(()=>a.value.length>0||s.value.length>0),y=f(()=>a.value.length>0?a.value[0]:null);async function v(){l.value=!0,e.value=null;try{n.value=await c.getProjects()}catch(i){throw e.value=i instanceof Error?i.message:"Failed to fetch projects",i}finally{l.value=!1}}async function h(i={}){l.value=!0,e.value=null;try{const o=await c.getRuns(i);return a.value=o.runs,o}catch(o){throw e.value=o instanceof Error?o.message:"Failed to fetch test runs",o}finally{l.value=!1}}async function w(i={}){l.value=!0,e.value=null;try{const o=await c.getTestCases(i);return s.value=o.cases,o}catch(o){throw e.value=o instanceof Error?o.message:"Failed to fetch test cases",o}finally{l.value=!1}}async function p(i={}){l.value=!0,e.value=null;try{return r.value=await c.getStats(i),r.value}catch(o){throw e.value=o instanceof Error?o.message:"Failed to fetch statistics",o}finally{l.value=!1}}async function b(i){l.value=!0,e.value=null;try{const o=await c.uploadTestResults(i);return await Promise.all([h(),p()]),o}catch(o){throw e.value=o instanceof Error?o.message:"Failed to upload file",o}finally{l.value=!1}}function _(i){t.value=i}function $(){e.value=null}function S(){a.value=[],t.value=null,s.value=[],r.value=null,n.value=[],l.value=!1,e.value=null}return{runs:a,currentRun:t,cases:s,stats:r,projects:n,loading:l,error:e,hasData:d,latestRun:y,fetchProjects:v,fetchRuns:h,fetchCases:w,fetchStats:p,uploadFile:b,setCurrentRun:_,clearError:$,reset:S}});function U(a){try{const t=typeof a=="string"?new Date(a):a;return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid Date"}}function z(a){if(a<0||a===0)return"0ms";if(a<1e3)return`${a}ms`;if(a<6e4)return`${(a/1e3).toFixed(2)}s`;const t=Math.floor(a/36e5),s=Math.floor(a%36e5/6e4),r=Math.floor(a%6e4/1e3),n=[];return t>0&&n.push(`${t}h`),s>0&&n.push(`${s}m`),r>0&&n.push(`${r}s`),n.join(" ")}function Q(a){return a.toLocaleString("en-US")}function I(a){switch(a.toLowerCase()){case"passed":return"✓";case"failed":return"✗";case"error":return"⚠";case"skipped":return"⊘";default:return"?"}}function N(a){if(a===0)return"0 B";const t=["B","KB","MB","GB","TB"],s=1024,r=Math.floor(Math.log(a)/Math.log(s));return r===0?`${a} ${t[r]}`:`${(a/Math.pow(s,r)).toFixed(2)} ${t[r]}`}function O(a,t=50){return a.length<=t?a:a.substring(0,t)+"..."}const E=["disabled"],R={key:0,class:"spinner"},M=q({__name:"Button",props:{variant:{default:"primary"},size:{default:"md"},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1}},emits:["click"],setup(a,{emit:t}){const s=a,r=t,n=f(()=>["btn",`btn-${s.variant}`,`btn-${s.size}`,{"btn-disabled":s.disabled,"btn-loading":s.loading,"btn-full-width":s.fullWidth}]),l=e=>{!s.disabled&&!s.loading&&r("click",e)};return(e,d)=>(m(),g("button",{class:F(n.value),disabled:a.disabled||a.loading,onClick:l},[a.loading?(m(),g("span",R)):B("",!0),j(e.$slots,"default",{},void 0)],10,E))}}),L=T(M,[["__scopeId","data-v-05997f5e"]]);export{L as B,c as a,z as b,U as c,N as d,Q as f,I as g,O as t,C as u};
