echo "ğŸ” Running code quality checks..."
echo ""

# Run lint-staged for staged files
npx lint-staged

# If lint-staged passed, show success message
if [ $? -eq 0 ]; then
  echo ""
  echo "âœ… Linting checks passed!"
  echo ""
else
  echo ""
  echo "âŒ Code quality checks failed. Please fix the errors above."
  echo "ğŸ’¡ Tip: Run 'npm run lint:fix' to automatically fix some issues."
  echo ""
  exit 1
fi

# Run npm audit in client directory
echo "ğŸ”’ Running security audit for client..."
cd client
npm audit --audit-level=moderate
CLIENT_AUDIT=$?
cd ..

if [ $CLIENT_AUDIT -ne 0 ]; then
  echo ""
  echo "âŒ Client security audit failed!"
  echo "ğŸ’¡ Run 'cd client && npm audit fix' to fix vulnerabilities"
  echo ""
  exit 1
fi

# Run npm audit in backend directory
echo "ğŸ”’ Running security audit for backend..."
cd backend
npm audit --audit-level=moderate
BACKEND_AUDIT=$?
cd ..

if [ $BACKEND_AUDIT -ne 0 ]; then
  echo ""
  echo "âŒ Backend security audit failed!"
  echo "ğŸ’¡ Run 'cd backend && npm audit fix' to fix vulnerabilities"
  echo ""
  exit 1
fi

echo ""
echo "âœ… All code quality and security checks passed!"
echo ""
